import{r as a,j as e,H as I}from"./index-BPMqf66b.js";const b=({description:s})=>e.jsxs("div",{className:"descriptive-image-bubble",children:[e.jsx("div",{className:"descriptive-image-icon",children:e.jsx("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M811.272038 156.318208l-595.873246 0c-46.818305 0-85.124749 38.306444-85.124749 85.124749l0 535.616884c0 46.818305 38.306444 85.124749 85.124749 85.124749l595.873246 0c46.818305 0 85.124749-38.306444 85.124749-85.124749l0-535.616884C896.396787 194.624652 858.090343 156.318208 811.272038 156.318208zM318.595129 255.961626c42.952254 0 77.771271 34.819017 77.771271 77.771271s-34.819017 77.771271-77.771271 77.771271-77.771271-34.819017-77.771271-77.771271S275.642874 255.961626 318.595129 255.961626zM215.398792 734.497467l148.9678-197.609637 106.405425 127.687124 148.968823-191.530175 191.530175 261.45371L215.398792 734.49849z"})})}),e.jsx("p",{children:s})]}),L=({post:s,author:h,personas:x,onAddComment:f,onLikePost:g,onDeletePost:N})=>{const[m,v]=a.useState(""),[p,r]=a.useState(!1),[o,c]=a.useState(!1),u=a.useRef(null),j=a.useRef(null);a.useEffect(()=>{const n=l=>{u.current&&!u.current.contains(l.target)&&r(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),a.useEffect(()=>{var n;o&&((n=j.current)==null||n.focus())},[o]);const d=()=>{m.trim()&&(f(s.id,m.trim()),v(""),c(!1))},C=()=>{g(s.id),r(!1)},k=()=>{c(!0),r(!1)},w=()=>{N(s.id),r(!1)},M="user",t=(s.likes||[]).length>0||(s.comments||[]).length>0,i=s.content.match(/\[image:(.*?)\]/),S=i?s.content.replace(/\[image:.*?\]\s*/,"").trim():s.content;return e.jsxs("div",{className:"moment-post",children:[e.jsxs("div",{className:"moment-header",children:[e.jsx("img",{src:h.avatarUrl,alt:h.name,className:"avatar"}),e.jsx("h4",{children:h.name})]}),S&&e.jsx("p",{className:"moment-content",children:S}),i&&e.jsx(b,{description:i[1].trim()}),e.jsxs("div",{className:"moment-footer",children:[e.jsx("span",{className:"moment-timestamp",children:s.timestamp}),e.jsx("div",{className:"moment-actions-trigger",onClick:()=>r(n=>!n),children:"..."}),p&&e.jsxs("div",{className:"moment-actions-menu",ref:u,children:[e.jsxs("div",{className:"action-item",onClick:C,children:[e.jsx("svg",{viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(s.likes||[]).includes(M)?"取消赞":"赞"]}),e.jsxs("div",{className:"action-item",onClick:k,children:[e.jsx("svg",{viewBox:"0 0 24 24",children:e.jsx("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18z"})}),"评论"]}),e.jsxs("div",{className:"action-item",onClick:w,children:[e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),"删除"]})]})]}),(t||o)&&e.jsxs("div",{className:"likes-and-comments-section",children:[(s.likes||[]).length>0&&e.jsxs("div",{className:"likes-section",children:[e.jsx("svg",{viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(s.likes||[]).map((n,l)=>{var E;return e.jsxs("span",{className:"like-author",children:[(E=x[n])==null?void 0:E.name,l<s.likes.length-1?"，":""]},n)})]}),(s.comments||[]).map(n=>{const l=x[n.authorId];return l?e.jsxs("div",{className:"comment-item",children:[e.jsx("img",{src:l.avatarUrl,alt:l.name,className:"avatar"}),e.jsxs("div",{className:"comment-content",children:[e.jsx("span",{className:"comment-author",children:l.name}),e.jsx("span",{children:n.content})]})]},n.id):null})]}),o&&e.jsxs("div",{className:"comment-input-area",children:[e.jsx("input",{ref:j,type:"text",placeholder:"添加评论...",value:m,onChange:n=>v(n.target.value),onKeyPress:n=>n.key==="Enter"&&d(),onBlur:()=>{!m&&c(!1)}}),e.jsx("button",{onClick:d,disabled:!m.trim(),children:"发送"})]})]})},R=({personas:s,posts:h,onGenerate:x,onAddComment:f,onAddPost:g,userName:N,userAvatar:m,momentsBackground:v,onLikePost:p,onDeletePost:r})=>{const[o,c]=a.useState(!1),[u,j]=a.useState(!1),d=a.useRef(null);a.useEffect(()=>{const t=i=>{d.current&&!d.current.contains(i.target)&&c(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const C=t=>{j(t.currentTarget.scrollTop>220)},k=()=>{c(!1),g()},w=()=>{c(!1),x()},M={backgroundImage:`url(${v||"https://source.unsplash.com/random/800x500?nature,landscape"})`};return e.jsxs("div",{className:"moments-page",children:[e.jsx(I,{title:"朋友圈",onAction:()=>c(t=>!t),actionIcon:"camera",className:`moments-header ${u?"opaque":""}`}),o&&e.jsxs("div",{className:"moments-action-menu",ref:d,children:[e.jsx("div",{onClick:k,children:"发表动态"}),e.jsx("div",{onClick:w,children:"AI发表动态"})]}),e.jsxs("main",{className:"main-content moments-view",onScroll:C,children:[e.jsxs("div",{className:"moments-feed-header",children:[e.jsx("div",{className:"moments-cover-photo",style:M}),e.jsxs("div",{className:"moments-user-info",children:[e.jsx("span",{children:N}),e.jsx("img",{src:m,alt:"user avatar",className:"avatar"})]})]}),e.jsx("div",{className:"moments-posts-list",children:h.map(t=>{const i=s[t.authorId];return i?e.jsx(L,{post:t,author:i,personas:s,onAddComment:f,onLikePost:p,onDeletePost:r},t.id):null})})]})]})};export{R as default};

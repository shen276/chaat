import{r as l,j as e,H as D,A as L,i as $}from"./index-BdaxE78_.js";const R=({todos:t,onUpdate:r})=>{const[c,x]=l.useState(""),m=()=>{if(!c.trim())return;const s=[...t,{id:Date.now(),text:c.trim(),done:!1}];r(s),x("")},o=s=>{const d=t.map(v=>v.id===s?{...v,done:!v.done}:v);r(d)},h=s=>{const d=t.filter(v=>v.id!==s);r(d)},u=[...t].sort((s,d)=>s.done===d.done?0:s.done?1:-1);return e.jsxs("div",{className:"character-addons-container",children:[e.jsx("div",{className:"todo-list",children:u.map(s=>e.jsxs("div",{className:"todo-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.done,onChange:()=>o(s.id)}),e.jsx("span",{className:`todo-text ${s.done?"completed":""}`,children:s.text})]}),e.jsx("button",{className:"delete-btn",onClick:()=>h(s.id),children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]},s.id))}),e.jsxs("div",{className:"input-box",children:[e.jsx("input",{type:"text",className:"text-input",value:c,onChange:s=>x(s.target.value),placeholder:"+ 添加新的待办...",onKeyPress:s=>s.key==="Enter"&&m()}),e.jsx("button",{onClick:m,className:"add-task-btn",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]})]})},U=({anniversaries:t,onUpdate:r})=>{const[c,x]=l.useState(""),[m,o]=l.useState(new Date().toISOString().split("T")[0]),[h,u]=l.useState(!1),s=()=>{if(!c.trim()||!m)return;const n=[...t,{id:Date.now(),name:c.trim(),date:m,pinned:h}];r(n),x(""),o(new Date().toISOString().split("T")[0]),u(!1)},d=n=>{r(t.filter(i=>i.id!==n))},v=n=>{r(t.map(i=>i.id===n?{...i,pinned:!i.pinned}:i))},N=[...t].sort((n,i)=>(i.pinned?1:0)-(n.pinned?1:0)||new Date(n.date).getTime()-new Date(i.date).getTime());return e.jsxs("div",{className:"character-addons-container",children:[e.jsx("div",{className:"add-anni-form card",children:e.jsxs("div",{className:"add-anni-controls",children:[e.jsx("input",{type:"text",value:c,onChange:n=>x(n.target.value),className:"text-input",placeholder:"纪念日名称"}),e.jsx("input",{type:"date",value:m,onChange:n=>o(n.target.value),className:"text-input"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:n=>u(n.target.checked)}),"置顶显示"]}),e.jsxs("button",{onClick:s,className:"btn btn-full-width",children:[e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),"添加纪念日"]})]})}),e.jsx("div",{className:"anni-list",children:N.map(n=>{const i=new Date,w=new Date(i.getFullYear(),i.getMonth(),i.getDate()),f=new Date(n.date),g=Math.ceil((f.getTime()-w.getTime())/(1e3*60*60*24));let j;g===0?j="今天!":g===1?j="明天!":g>1?j=`还有 ${g} 天`:j=`已过去 ${Math.abs(g)} 天`;const b=n.pinned?"btn-icon active":"btn-icon";return e.jsx("div",{className:"anni-item card",children:e.jsxs("div",{className:"anni-item-content",children:[e.jsxs("div",{className:"anni-item-text",children:[e.jsx("strong",{className:"anni-item-name",children:n.name}),e.jsxs("small",{className:"anni-item-date",children:[n.date," (",j,")"]})]}),e.jsxs("div",{className:"anni-item-actions",children:[e.jsx("button",{className:b,onClick:()=>v(n.id),title:n.pinned?"取消置顶":"置顶",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"})})}),e.jsx("button",{className:"btn-icon btn-icon-danger",onClick:()=>d(n.id),children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]})]})},n.id)})})]})},Y=t=>{if(!t||t.length===0)return null;const r=new Date,c=new Date(r.getFullYear(),r.getMonth(),r.getDate()),x=c.getFullYear(),m=t.map(o=>{const h=new Date(o.date);let u=new Date(x,h.getMonth(),h.getDate());u<c&&u.setFullYear(x+1);const s=u.getTime()-c.getTime(),d=Math.ceil(s/(1e3*60*60*24));return{name:o.name,daysLeft:d}});return m.sort((o,h)=>o.daysLeft-h.daysLeft),m[0]},P=({character:t,onBack:r,onSave:c,userName:x,onDelete:m})=>{const[o,h]=l.useState(t.name),[u,s]=l.useState(t.avatarUrl),[d,v]=l.useState(t.systemInstruction),[N,n]=l.useState(t.chatBackgroundUrl),[i,w]=l.useState(t.nicknameForUser||""),[f,g]=l.useState(t.autoReplyDelay||0),[j,b]=l.useState(t.historyMemory||0),[T,F]=l.useState(t.todos||[]),[C,I]=l.useState(t.anniversaries||[]),[A,y]=l.useState(null),S=l.useRef(null),H=()=>{o.trim()&&d.trim()&&c(t.id,o.trim(),u.trim(),d.trim(),N,i.trim(),f,T,C,j)},z=async a=>{var V;const p=(V=a.target.files)==null?void 0:V[0];if(p)try{const k=await $(p);n(k)}catch(k){console.error("Error converting file to Base64",k),alert("无法加载图片。")}};if(A==="todo")return e.jsxs("div",{className:"details-view addon-view",children:[e.jsx(D,{title:"待办清单",onBack:()=>y(null)}),e.jsx("main",{className:"main-content details-main-content no-padding",children:e.jsx(R,{todos:T,onUpdate:F})})]});if(A==="anniversary")return e.jsxs("div",{className:"details-view addon-view",children:[e.jsx(D,{title:"纪念日",onBack:()=>y(null)}),e.jsx("main",{className:"main-content details-main-content no-padding",children:e.jsx(U,{anniversaries:C,onUpdate:I})})]});const M=Y(C),B=a=>{if(!a)return null;let p="";return a.daysLeft===0?p="今天!":a.daysLeft===1?p="明天!":a.daysLeft>1&&(p=`还有 ${a.daysLeft} 天`),p?`${a.name} ${p}`:null};return e.jsxs("div",{className:"details-view",children:[e.jsx(D,{title:"角色详情",onBack:r}),e.jsx("main",{className:"main-content details-main-content",children:e.jsxs("div",{className:"details-form",children:[e.jsx(L,{currentAvatar:u,onAvatarChange:s,className:"modal-avatar-uploader"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"char-name-edit",children:"名字"}),e.jsx("input",{id:"char-name-edit",type:"text",value:o,onChange:a=>h(a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"char-nickname-edit",children:"对你的昵称"}),e.jsx("input",{id:"char-nickname-edit",type:"text",value:i,onChange:a=>w(a.target.value),placeholder:`例如：船长, 老板, ${x}`})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"char-autoreply-edit",children:"自动回复延迟 (分钟)"}),e.jsx("input",{id:"char-autoreply-edit",type:"number",min:"0",value:f,onChange:a=>g(parseInt(a.target.value,10)||0),placeholder:"0为禁用"}),e.jsx("small",{className:"form-group-note",children:"设置在你离开时角色主动找你聊天的时间。设为0则禁用。"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"char-history-memory",children:"AI记忆深度 (消息数)"}),e.jsx("input",{id:"char-history-memory",type:"number",min:"0",value:j,onChange:a=>b(parseInt(a.target.value,10)||0)}),e.jsx("small",{className:"form-group-note",children:"AI能记住的过去消息的最大数量。0代表无限制。"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"char-instruction-edit",children:"角色设定 (System Instruction)"}),e.jsx("textarea",{id:"char-instruction-edit",value:d,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"settings-section details-settings-section",children:[e.jsxs("div",{className:"settings-item",onClick:()=>{var a;return(a=S.current)==null?void 0:a.click()},children:[e.jsx("span",{children:"聊天背景"}),e.jsxs("div",{className:"background-preview-wrapper",children:[N&&e.jsx("img",{src:N,className:"background-preview",alt:"background preview"}),e.jsx("span",{className:"arrow",children:">"})]}),e.jsx("input",{type:"file",ref:S,style:{display:"none"},accept:"image/*",onChange:z})]}),e.jsxs("div",{className:"settings-item",onClick:()=>y("todo"),children:[e.jsx("span",{children:"待办清单"}),e.jsx("div",{className:"addon-summary",children:e.jsx("span",{className:"arrow",children:">"})})]}),e.jsxs("div",{className:"settings-item",onClick:()=>y("anniversary"),children:[e.jsx("span",{children:"纪念日"}),e.jsxs("div",{className:"addon-summary",children:[B(M)&&e.jsx("span",{className:"next-event",children:B(M)}),e.jsx("span",{className:"arrow",children:">"})]})]})]}),e.jsx("button",{className:"save-btn-full",onClick:H,children:"保存更改"}),e.jsx("button",{className:"delete-btn-full",onClick:()=>m(t.id),children:"删除角色"})]})})]})};export{P as default};
